# 操作マニュアル

# 1 本書について

本書では、TwinLinkシステム（以下「本システム」という。）で使用する外部空間IDデータ連携機能の操作手順について記載しています。

# 2 使い方

## 2-1 リクエスト送信（空間IDにひも付く人流データの一覧取得）

本システムの外部空間IDデータ連携機能サーバへ以下のリクエストを送信します。

HTTPメソッド：GET, POST

リクエストURL：/population

リクエストパラメータ

| パラメータ名       | 内容   | 必須条件  | 備考 |
| ------------ | ------------ | ------------ |  ------------ | 
| spatialId | 空間ID | YES | カンマ区切りで複数指定可能 |
| time | 取得対象の日時 | NO | 日時はRFC3339 formatで指定してください<br>日付を指定しない場合、最新のデータが返されます |

上記リクエストを送信すると、人流データが返却されます。

リクエストのイメージは以下のとおりです。

GETの場合
```
 /population?spatialId="/15/0/1111/1111,/15/0/2222/2222,/15/0/3333/3333”&time=2023-09-14T15:59:50+09
```

POSTの場合
```
{
    "spatialId":"/15/0/1111/1111,/15/0/2222/2222,/15/0/3333/3333",
    "time":"2023-09-14T15:59:50+09:00"
}
```


# 3 出力データ
外部空間IDデータ連携機能（空間IDにひも付くデータの一覧取得）で出力されるデータは以下のとおりです。

| 機能    | 出力データ    | 内容  | データ形式 |
| ------------ | ------------ | ------------ |  ------------ | 
| 外部空間IDデータ連携 | 人流データ | 空間IDにひも付く人流データの一覧 | JSON |

## 3-1 人流データ
指定された空間ID及び指定された日時の空間IDにひも付く人流データを出力します。

| キー名       |  内容  | 備考 |
| ------------ | ------------ | ------------ |  ------------ | 
| data | レスポンスデータの構造体 |  |
| id | 指定された空間ID |  |
| type | 取得された人流データの種類（実測値/補完値） | "measured"：実測データ <br> "interpolated"：補完データ |
| values | 特定の空間IDと日時に存在する人流データの構造体 | リクエストで指定した空間ID分出力されます |
| timestamp | 人流データ取得対象の日時 |  |
| unit | 人流データの集計時間 | "minutes"固定 |
| peopleFlow | 特定の空間IDと日時に存在する人流データ |  |


レスポンスのイメージは以下のとおりです。

```
{
  "data": [
        {
            "id": "/15/0/1111/1111",
            "type": "measured" //実測データ
            "values": [
                {
                    "timestamp": "2023-09-14T15:59:50+09:00",
                    "unit": "minutes",
                    "peopleFlow": 100,
                },
            ]
        },
        {
            "id": "/15/0/2222/2222",
            "type": "interpolated" //補完データ
            "values": [
                {
                    "timestamp": "2023-09-14T15:59:50+09:00",
                    "unit": "minutes",
                    "peopleFlow": 100,
                },
            ]
        }
...
    ]
}
```
